<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		<!-- workflow -->
		<record id="hr_job_wkf" model="workflow">
			<field name="name">Workflow Poste</field>
			<field name="osv">hr.job</field>
			<field name="on_create">True</field>
		</record>

		<!-- recruit,analyse,rr_validation,open,tdr_redaction,approuved -->

		<!-- activity -->
		<record id="activity_recruit" model="workflow.activity">
			<field name="wkf_id" ref="hr_job_wkf" />
			<field name="name">activity_recruit</field>
			<field name="kind">function</field>
			<field name="action">write({'state':'recruit'})</field>
		</record>
		<record id="activity_validation_finance" model="workflow.activity">
			<field name="wkf_id" ref="hr_job_wkf" />
			<field name="name">activity_validation_finance</field>
			<field name="kind">function</field>
			<field name="action">write({'state':'validation_finance'})</field>
		</record>
		<record id="activity_analyse" model="workflow.activity">
			<field name="wkf_id" ref="hr_job_wkf" />
			<field name="name">activity_analyse</field>
			<field name="kind">function</field>
			<field name="action">write({'state':'analyse'})</field>
		</record>

		<record id="activity_rr_validation" model="workflow.activity">
			<field name="wkf_id" ref="hr_job_wkf" />
			<field name="name">activity_rr_validation</field>
			<field name="kind">function</field>
			<field name="action">write({'state':'rr_validation'})</field>
		</record>
		<record id="activity_open" model="workflow.activity">
			<field name="wkf_id" ref="hr_job_wkf" />
			<field name="name">activity_open</field>
			<field name="kind">function</field>
			<field name="action">write({'state':'open'})</field>
		</record>
		<record id="activity_refused" model="workflow.activity">
			<field name="wkf_id" ref="hr_job_wkf" />
			<field name="name">activity_refused</field>
			<!-- <field name="flow_stop">True</field> -->
			<field name="kind">function</field>
			<field name="action">write({'state':'refused'})</field>
		</record>

		<!-- transition -->
		<record id="activity_refused_to_activity_reopen" model="workflow.transition">
			<field name="act_from" ref="activity_refused" />
			<field name="act_to" ref="activity_open" />
			<field name="signal">button_reopen</field>
		</record>

		<record id="activity_open_to_activity_validation_finance"
			model="workflow.transition">
			<field name="act_from" ref="activity_open" />
			<field name="act_to" ref="activity_validation_finance" />
			<field name="condition">wkf_cond_open_to_validation_finance()</field>
			<field name="signal">button_validation_finance</field>
		</record>
		<record id="activity_open_to_activity_analyse" model="workflow.transition">
			<field name="act_from" ref="activity_validation_finance" />
			<field name="act_to" ref="activity_analyse" />
			<field name="signal">button_analyse</field>
		</record>
		<record id="activity_analyse_to_activity_rr_validation" model="workflow.transition">
			<field name="act_from" ref="activity_analyse" />
			<field name="act_to" ref="activity_rr_validation" />
			<field name="signal">button_rr_validation</field>
		</record>
		<record id="activity_rr_validation_to_activity_refused" model="workflow.transition">
			<field name="act_from" ref="activity_rr_validation" />
			<field name="act_to" ref="activity_refused" />
			<field name="signal">button_refuser</field>
		</record>

		<record id="activity_analyse_to_activity_refused" model="workflow.transition">
			<field name="act_from" ref="activity_analyse" />
			<field name="act_to" ref="activity_refused" />
			<field name="signal">button_refuser</field>
		</record>
		<record id="activity_rr_validation_to_activity_recruit" model="workflow.transition">
			<field name="act_from" ref="activity_rr_validation" />
			<field name="act_to" ref="activity_recruit" />
			<field name="signal">button_accepter</field>
		</record>
		<record id="activity_analyse_to_activity_recruit" model="workflow.transition">
			<field name="act_from" ref="activity_analyse" />
			<field name="act_to" ref="activity_recruit" />
			<field name="signal">button_accepter</field>
		</record>

		<!-- transition pour relancer le workflow depuis le debut -->
		<record id="activity_recruit_to_activity_open" model="workflow.transition">
			<field name="act_from" ref="activity_recruit" />
			<field name="act_to" ref="activity_open" />
			<field name="signal">button_relance</field>
		</record>
		
		<record model="ir.ui.view" id="confirm_relance_form">
			<field name="name">confirm.relance.form</field>
			<field name="model">confirm.relance</field>
			<field name="arch" type="xml">
				<form string="Confirmation de relancement">
					<field name="yes_no" readonly="1" />
					<footer>
						<button class="oe_highlight" name="yes" type="object"
							string="Oui" />
						<button class="oe_highlight" name="no" type="object"
							string="Non" />
					</footer>
				</form>
			</field>
		</record>
		
		<record model="ir.actions.act_window" id="action_confirm_relance">
			<field name="name">confirm.relance.form</field>
			<field name="view_mode">form</field>
			<field name="res_model">confirm.relance</field>
			<field name="view_id" ref="confirm_relance_form" />
			<field name="help" type="html">
				<p class="oe_view_nocontent_create">
					It's empty, create something
				</p>
			</field>
		</record>

	</data>
</odoo>