<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<record id="view_hr_job_form4" model="ir.ui.view">
		<field name="name">hr.job.form4</field>
		<field name="model">hr.job</field>
		<field name="inherit_id" ref="hr_recruitment.view_hr_job_kanban" />
		<field name="arch" type="xml">
			<xpath expr="//button[@name='set_recruit']" position="replace">
				<button name="set_recruit" invisible="1" />
			</xpath>
		</field>
	</record>
	<record id="view_hr_job_form3" model="ir.ui.view">
		<field name="name">hr.job.form2</field>
		<field name="model">hr.job</field>
		<field name="inherit_id" ref="hr_recruitment.hr_job_survey" />
		<field name="arch" type="xml">
			<field name="no_of_recruitment" position="attributes">
				<attribute name="string">Nombre de poste(s) à pouvoir</attribute>
			</field>
			<field name="user_id" position="replace">
				<field name="user_id" required="1" string="Responsable de recrutement" />
				<field name="name_of_claimant" />
			</field>
			<field name="address_id" position="after">
				<field name="ref_of_demand" />
				<field name="date_of_demand" required="1" string="Date de la demande"/>
				<field name="psi_motif" attrs="{'required': [('state', 'in', ('open'))]}" string="Motif du recrutement"/>
				<field name="nature_recrutement" string="Nature de recrutement" required="1" /> <!-- attrs="{'invisible': [('recrutement_type','!=','consultant')], 'required': [('recrutement_type', '=', 'consultant')]}" -->
				<field name="place_of_work" widget="many2many_tags"/>
				<field name="place_of_employment" />
				<field name="application_deadline_date" string="Date limite de candidature" attrs="{'required': [('state', 'in', ('open'))]}"/>
				<field name="psi_budget_code_distribution" options="{'no_quick_create': True, 'no_create_edit' : True}" attrs="{'required': [('state', '=', 'validation_finance')]}"/>
				<field name="psi_contract_type" string="Type de contrat" attrs="{'required': [('state', 'in', ('open'))]}" />
				<field name="psi_contract_duration" attrs="{'invisible': ['|',('psi_contract_type','=','cdi'),('psi_contract_type','=','prestataire')], 'required': [('psi_contract_type', '=', 'cdd')]}" />
				<field name="rr_approbation" attrs="{'readonly': [('nature_recrutement', '=', 'interne')]}" />
				<field name="psi_memo" attrs="{'invisible': [('nature_recrutement', '!=', 'conssideration_dossier')]}"/>
				<field name="tdr_add" required="1" string="TDR"/>
				<field name="psi_job_equipment" colspan="2">
					<tree string="psi_job_equipment" editable="bottom">
						<field name="equipment_id" />
						<field name="equipment_state" />
					</tree>
				</field>
			</field>
			<field name="address_id" position="replace">
				<field name="address_id" invisible="1" />
			</field>
		</field>
	</record>
	<record id="view_hr_job_tree_psi" model="ir.ui.view">
		<field name="name">hr.job.tree</field>
		<field name="model">hr.job</field>
		<field name="inherit_id" ref="hr.view_hr_job_tree" />
		<field name="arch" type="xml">
			<field name="no_of_recruitment" position="replace">
				<field name="no_of_recruitment" string="Nombre de poste(s) à pouvoir" />
			</field>
		</field>
	</record>
	
	<record id="view_hr_job_form2" model="ir.ui.view">
		<field name="name">hr.job.form</field>
		<field name="model">hr.job</field>
		<field name="inherit_id" ref="hr.view_hr_job_form" />
		<field name="arch" type="xml">
			<field name="department_id" position="after">
				<field name="recrutement_type_id" string="Type de recrutement"/>
				<field name="recrutement_type" invisible="1" />
				<field name="psi_category" required="1" string="Catégorie professionnelle"/>
				<field name="superior_hierarchical" required="1" string="Supérieur Hiérarchique"/>
				<field name="subordination_link_id" require="1"/>
				<field name="psi_date_start" required="1" string="Date de prise de fonction souhaitée"/>
				<field name="level_of_education_id" />
				<field name="experience_required_ids" string="Expériences requises" colspan="2">
					<tree string="Experience requise" editable="bottom">
						<field name="name" />
						<field name="month"/>
						<field name="year"/>
					</tree>
				</field>
				<field name="poste_description" />
			</field>
			<field name="department_id" position="replace">
				<field name="department_id" required="1" string="Département" />
			</field>
			<button name="set_recruit" position="replace">
				<button name="set_recruit" invisible="1" />
			</button>
			<button name="set_open" position="replace">
				<button name="set_open" invisible="1" />
			</button>
			
			<field name="message_follower_ids" position="after">
				<field name="message_ids" widget="mail_thread"/>
			</field>

			<xpath expr="//field[@name='state']" position="replace">
				<!-- etats pour recrutement autres que stagiaires ??? -->
				<field name="state" widget="statusbar"
					statusbar_visible="open,validation_finance,analyse,rr_validation,refused,recruit" />

				<!-- etats pour recrutement de stagiaires ??? -->
			</xpath>

			<!-- boutons -->
	
			<xpath expr="//button[@name='set_open']" position="after">
				<button name="button_refuser" states="analyse,rr_validation"
					string="Refuser" attrs="{'invisible': [('state','!=','analyse')]}" />
			</xpath>
			
			<xpath expr="//button[@name='set_open']" position="after">
				<button name="button_rr_validation" string="Analyse Faite" class="oe_highlight"
					attrs="{'invisible': ['|', ('rr_approbation', '=', False), ('state','!=','analyse')]}" />
			</xpath>
			<xpath expr="//button[@name='set_open']" position="after">
				<button name="button_reopen" string="Refaire la demande" class="oe_highlight" 
					attrs="{'invisible': [('state', '!=', 'refused')]}"/>
			</xpath>
			<xpath expr="//button[@name='set_open']" position="after">
				<button name="relance" string="Relancer la demande" type="object" class="oe_highlight" 
					attrs="{'invisible': [('state', '!=', 'recruit')]}"/>
			</xpath>
			
			<xpath expr="//button[@name='set_open']" position="after">
				<button name="button_accepter" string="Approuver" state="analyse" 
					attrs="{'invisible': ['|', '&amp;', ('rr_approbation', '=', True), ('state', '!=', 'rr_validation'), '&amp;', ('rr_approbation', '=', False), ('state','!=', 'analyse')]}"
					class="oe_highlight" />
			</xpath>
			
			<xpath expr="//button[@name='set_open']" position="after">
				<button name="button_analyse" string="Validation faite" attrs="{'invisible': [('state','!=','validation_finance')]}"
					class="oe_highlight" />
			</xpath>
			
			<xpath expr="//button[@name='set_open']" position="after">
				<button name="button_validation_finance" string="Passer à Validation Finance"
					class="oe_highlight" attrs="{'invisible': [('state','!=','open')]}"  />
			</xpath>

		</field>
	</record>

	<record id="hr_job_simple_form2" model="ir.ui.view">
		<field name="name">hr.job.simple.form1</field>
		<field name="model">hr.job</field>
		<field name="inherit_id" ref="hr_recruitment.hr_job_simple_form" />
		<field name="arch" type="xml">
			<data>
				<field name="name" position="after">
					<field name="recrutement_type_id" />
					<field name="recrutement_type" invisible="1" />
					<field name="tdr_file" context="{'default_res_model': 'hr.job','default_res_id': active_id}" />
				</field>
			</data>
		</field>
	</record>
	
	<!-- Publish button - Smart button -->	
	<!-- BEGIN Make visible publish button in state recruit -->
    <record id="website_published_button_visibility" model="ir.ui.view" >
        <field name="name">website.published.button.visibility</field>        
        <field name="model">hr.job</field>
        <field name="inherit_id" ref="hr.view_hr_job_form"/>        
        <field name="arch" type="xml">
        
            <xpath expr="//div[@name='button_box']" position="replace">	
            	<div class="oe_button_box" name="button_box">
	           		<button class="oe_stat_button"
	                    icon="fa-file-o"
	                    name="%(hr_recruitment.action_hr_job_applications)d"
	                    context="{'default_user_id': user_id}"
	                    type="action">
	                    <field name="application_count" widget="statinfo" string="Candidature(s)"/>
	                </button>
	                <button class="oe_stat_button"
	                    icon="fa-users"
	                    name="%(hr_recruitment.action_hr_job_no_employee)d"
	                    type="action">
	                    <field name="no_of_employee" widget="statinfo" string="Employé(s)"/>
	                </button>
	                <button class="oe_stat_button"
	                    icon="fa-book"
	                    name="action_get_attachment_tree_view"
	                    type="object">
	                    <field name="documents_count" widget="statinfo" string="Document(s)"/>
	                </button>
	                <button class="oe_stat_button" type="action"
	                    name="%(hr_recruitment.action_hr_job_sources)d" icon="fa-share"
	                    context="{'default_job_id': active_id}">
	                    <div class="o_form_field o_stat_info">
	                        <span class="o_stat_text">Origine de l'offre</span>
	                    </div>
	                </button>
	                <button class="oe_stat_button" 
	                	name="website_publish_button"
	                    type="object"
	                    icon="fa-globe"
	                    attrs="{'invisible': [('state','!=','recruit')]}">
	                    <field name="website_published" widget="website_button"/>
	                </button>
	            </div>
            </xpath>            
        </field>
    </record>	    
	<!-- END Make visible publish button in state recruit -->
</odoo>
